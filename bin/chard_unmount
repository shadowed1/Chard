#!/bin/bash

RED=$(tput setaf 1)
GREEN=$(tput setaf 2)
YELLOW=$(tput setaf 3)
BLUE=$(tput setaf 4)
MAGENTA=$(tput setaf 5)
CYAN=$(tput setaf 6)
BOLD=$(tput bold)
RESET=$(tput sgr0)

STATE_FILE="$CHARD_ROOT/tmp/usb_mount_state"
MOUNT_POINT="$CHARD_ROOT/external"

if mountpoint -q "$MOUNT_POINT"; then
    sudo umount "$MOUNT_POINT" 2>/dev/null
fi

echo "${CYAN}Restoring:"
while read -r PART MP; do
    echo "${BOLD}  $PART to '$MP' ${RESET}"
    sudo mkdir -p "$MP"
    sudo mount "$PART" "$MP" 2>/dev/null
done < "$STATE_FILE"
sudo rm -f "$STATE_FILE" 2>/dev/null
