#!/bin/bash
USB_DEVICES=$(lsblk -dpno NAME,TRAN | awk '$2=="usb"{print $1}')

if [ -z "$USB_DEVICES" ]; then
    echo "No USB drives detected."
    exit 1
fi

echo "Detected USB drives:"
echo "$USB_DEVICES"
echo

if [ "$(echo "$USB_DEVICES" | wc -l)" -gt 1 ]; then
    echo "Multiple USB drives found. Enter the full device path to unmount (e.g. /dev/sdb):"
    read -r USB_DEV
else
    USB_DEV="$USB_DEVICES"
fi

MOUNTED_PARTS=$(lsblk -lnpo NAME,MOUNTPOINT "$USB_DEV" | awk '$2 != "" {print $1}')

if [ -z "$MOUNTED_PARTS" ]; then
    echo "No mounted partitions found on $USB_DEV"
fi

echo "Unmounting partitions on $USB_DEV:"
for part in $MOUNTED_PARTS; do
    echo "  sudo umount -l $part"
    sudo umount -l "$part" || {
        echo "Failed to unmount $part"
    }
done
