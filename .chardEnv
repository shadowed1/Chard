#!/bin/bash
# ========== Begin Chard Root Environment ==========

CHARD_ROOT="$HOME/opt/chard"
CHARD_LIB="$CHARD_ROOT/usr/lib"
CHARD_BIN="$CHARD_ROOT/usr/bin"
CHARD_SHARE="$CHARD_ROOT/share"

export FLATPAK_USER_DIR="$CHARD_SHARE/flatpak"
export XDG_RUNTIME_DIR="$CHARD_ROOT/.xdg-runtime-dir"
export TMPDIR="$HOME/tmp"

# Path helpers
add_to_path() {
  case ":$PATH:" in
    *":$1:"*) ;; *) PATH="$1:$PATH" ;; esac
}

add_to_ld_path() {
  case ":$LD_LIBRARY_PATH:" in
    *":$1:"*) ;; *) LD_LIBRARY_PATH="$1${LD_LIBRARY_PATH:+:$LD_LIBRARY_PATH}" ;; esac
}

add_to_pkg_path() {
  case ":$PKG_CONFIG_PATH:" in
    *":$1:"*) ;; *) PKG_CONFIG_PATH="$1${PKG_CONFIG_PATH:+:$PKG_CONFIG_PATH}" ;; esac
}

add_to_path "$CHARD_ROOT/bin"
add_to_path "$CHARD_ROOT/flatpak/usr/bin"
add_to_path "$CHARD_ROOT/flatpak-deps/usr/bin"
add_to_path "$CHARD_BIN"
add_to_path "$CHARD_LIB/xfce4"

add_to_ld_path "$CHARD_ROOT/flatpak-deps/usr/lib"
add_to_ld_path "$CHARD_LIB"

add_to_pkg_path "$CHARD_LIB/pkgconfig"

export PATH
export LD_LIBRARY_PATH
export PKG_CONFIG_PATH
export GIT_EXEC_PATH="$CHARD_LIB/git-core"
export DISPLAY=":0"

export GTK_USE_PORTAL=0
export FLATPAK_DISABLE_PORTAL=1
export XDG_DESKTOP_PORTAL_DIR=/dev/null
export XDG_CONFIG_DIRS="$CHARD_ROOT/etc/xdg"
export XDG_DATA_DIRS="$CHARD_SHARE"

: "${ELECTRON_FORCE_DEVICE_SCALE_FACTOR:=1.0}"
: "${XCURSOR_SIZE:=24}"
export ELECTRON_FORCE_DEVICE_SCALE_FACTOR
export XCURSOR_SIZE

export NVM_DIR="$CHARD_ROOT/usr/share/nvm"
[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"

chard_debug() {
  echo "==== CHARD ENVIRONMENT ===="
  echo "PATH=$PATH"
  echo "LD_LIBRARY_PATH=$LD_LIBRARY_PATH"
  echo "PKG_CONFIG_PATH=$PKG_CONFIG_PATH"
  echo "TMPDIR=$TMPDIR"
  echo "DISPLAY=$DISPLAY"
  echo "XDG_RUNTIME_DIR=$XDG_RUNTIME_DIR"
  echo "XDG_DATA_DIRS=$XDG_DATA_DIRS"
  echo "XDG_CONFIG_DIRS=$XDG_CONFIG_DIRS"
  echo "GTK_USE_PORTAL=$GTK_USE_PORTAL"
  echo "FLATPAK_DISABLE_PORTAL=$FLATPAK_DISABLE_PORTAL"
  echo "NVM_DIR=$NVM_DIR"
  echo "============================"
}

# ========== End Chard Root Environment ==========
